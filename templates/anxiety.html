<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>GAD-7 Anxiety Screening</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {
    background-color: #e9f7f9;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background-image: url('../static/images/anxietyBackground2.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    /* Remove the below two lines */
    /* height: 100vh; */
    /* display: flex; */
    /* justify-content: center;
    align-items: center; */
}
        .container-box {
            max-width: 850px;
            margin: 50px auto;
            border:  6px solid #46e1f5;
            background-color: #d8f5f5;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 25px;
            font-weight: bold;
            color: #333;
        }

        .form-label {
            font-weight: 500;
        }

        select.form-select {
            border-radius: 6px;
        }

        #result {
    display: none;
    background-color: #fffecd !important; /* soft yellow background */
    color: #856404 !important;           /* dark amber text */
    border: 2px solid #ffeeba;
    font-size: 18px;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    font-weight: 500;
    text-align: center;
}

        .btn-primary {
            font-weight: 600;
            width: 100%;
        }

        .alert {
            margin-top: 25px;
        }

        .modal-content {
            border: 6px solid #dbfd18;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <div class="container-box">
        <h2 style="color: #0d6efd; font-weight: bold;"><i class="fas fa-brain me-2"></i>Anxiety Screening</h2>
        <form id="gad7Form">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">1. Feeling nervous, anxious, or on edge</label>
                        <select class="form-select" name="q1" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">2. Not being able to stop or control worrying</label>
                        <select class="form-select" name="q2" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">3. Worrying too much about different things</label>
                        <select class="form-select" name="q3" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">4. Trouble relaxing</label>
                        <select class="form-select" name="q4" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">5. Being so restless that it’s hard to sit still</label>
                        <select class="form-select" name="q5" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">6. Becoming easily annoyed or irritable</label>
                        <select class="form-select" name="q6" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">7. Feeling afraid as if something awful might happen</label>
                        <select class="form-select" name="q7" required>
                            <option value="" disabled selected>Select</option>
                            <option value="0">Not at all</option>
                            <option value="1">Several days</option>
                            <option value="2">More than half the days</option>
                            <option value="3">Nearly every day</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-check-circle"></i> Submit
                Screening</button>
            <a href="/dashboard" class="btn btn-secondary w-100 mt-3"><i class="fas fa-arrow-left"></i> Back to
                Dashboard</a>
        </form>

        <div id="result" class="alert alert-info" style="display: none;">
            <!-- <h5>Your GAD-7 Score: <span id="scoreValue"></span></h5> -->
            <p id="resultText"></p>
        </div>
        <div class="d-flex justify-content-center">
        <button type="button" id="adviceBtn" class="btn btn-success mt-3" data-bs-toggle="modal"
            data-bs-target="#staticBackdrop" style="display: none;">
            <i class="fas fa-notes-medical me-2"></i>Get Advices
        </button>
        </div>
    </div>


    <!-- modal start-->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="adviceContent">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="downloadAdvicePDF()"><i
                            class="fas fa-download me-2"></i>Download report and advises</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal End-->

    <script>
        document.getElementById('gad7Form').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const response = await fetch('/anxiety', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            if (data.error) {
                alert(data.error);
            } else {
                // document.getElementById('scoreValue').innerText = data.score;
                document.getElementById('resultText').innerText = data.message;
                document.getElementById('result').style.display = 'block';

                document.getElementById("adviceBtn").style.display = "block";

                document.getElementById("staticBackdropLabel").innerHTML = data.message;
                document.getElementById("adviceContent").innerHTML = getAdvice(parseInt(data.score));

                setTimeout(() => {window.scrollTo({ top: 0, behavior: 'smooth' });}, 100); 
            }
        });


        function downloadAdvicePDF() {
            const adviceTitle = document.getElementById("staticBackdropLabel").innerText;
            const adviceBody = document.getElementById("adviceContent").innerHTML;

    // Inject into a printable visible container
    const printContainer = document.getElementById("printContainer");
    printContainer.innerHTML = `
        <div style="text-align: center; font-family: 'Segoe UI', sans-serif; margin-bottom: 20px; padding-bottom: 5px;">
            <h1 style="color: #1e88e5; font-size: 31px; margin-bottom: 0;">📝 Your Anxiety Screening Report</h1>
            <p style="color: #555; font-size: 16px; margin-top: 5px; border-bottom: 2px solid #2196f3;">Based on the GAD-7 Assessment</p>
        </div>
        <div style="color: #2196f3; font-size: 25px; padding-bottom: 10px;"><strong>${adviceTitle}</strong></div>
        <div style="font-family: Arial, sans-serif; font-size: 20px; padding-top: 10px;">${adviceBody}</div>
    `;
    printContainer.style.display = 'block';

    html2pdf()
        .from(printContainer)
        .set({
            margin: 10,
            filename: 'Anxiety_Screening_Report.pdf',
            html2canvas: { scale: 2, scrollY: 0 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        })
        .save()
        .then(() => {
            // Hide again after export
            printContainer.style.display = 'none';
        });
        }


        function getAdvice(score) {
            let advice = "";

            if (score <= 4) {
                // Minimal Anxiety
                advice = `<div class="p-3 rounded" style="background-color: #F0FFF0; color: #155724;">
        <h6><i class="fas fa-smile-beam"></i> 🟢 Minimal Anxiety (Score: ${score})</h6>
        <strong>✅ Status:</strong> You’re experiencing little to no anxiety symptoms. That’s great!<br><br>

        <strong>🧠 Daily Mental Wellness:</strong>
        <ul>
            <li>Stick to consistent sleep, meal, and movement routines.</li>
            <li>Spend time in nature — even 10 minutes can improve calmness.</li>
            <li>Practice gratitude — note 3 positive things daily.</li>
        </ul>

        <strong>🎯 Lifestyle Tips:</strong>
        <ul>
            <li>Balance screen time with offline hobbies (e.g., reading, crafts).</li>
            <li>Schedule "unplug" time every day — no devices, just presence.</li>
        </ul>

        <strong>📌 Long-Term Care:</strong>
        <ul>
            <li>Build emotional resilience through journaling or creative expression.</li>
            <li>Stay connected with people who uplift and support you.</li>
        </ul>
    </div>`;
            } else if (score <= 9) {
                // Mild Anxiety
                advice = `<div class="p-3 rounded" style="background-color: #FFFFE0; color: #856404;">
        <h6><i class="fas fa-meh-rolling-eyes"></i> 🟡 Mild Anxiety (Score: ${score})</h6>
        <strong>🔍 Interpretation:</strong> You may be showing mild anxiety symptoms. Early care can prevent escalation.<br><br>

        <strong>🧘 Coping Skills:</strong>
        <ul>
            <li>Try the 4-7-8 breathing technique twice daily to calm your nervous system.</li>
            <li>Engage in light exercise (like yoga or walking) to reduce cortisol levels.</li>
            <li>Use grounding techniques: identify 5 things you can see, 4 you can touch, etc.</li>
        </ul>

        <strong>📚 Cognitive Techniques:</strong>
        <ul>
            <li>Challenge anxious thoughts by writing them down and reframing them positively.</li>
            <li>Use apps like Woebot or Moodfit to support self-reflection.</li>
        </ul>

        <strong>📌 Follow-Up:</strong>
        <ul>
            <li>Track when and where anxiety shows up — patterns can help you adjust routines.</li>
            <li>If anxiety lasts for more than two weeks, consider speaking with a professional.</li>
        </ul>
    </div>`;
            } else if (score <= 14) {
                // Moderate Anxiety
                advice = `<div class="p-3 rounded" style="background-color: #FFDEAD; color: #7f4f00;">
        <h6><i class="fas fa-frown-open"></i> 🟠 Moderate Anxiety (Score: ${score})</h6>
        <strong>⚠️ Observation:</strong> Your symptoms may affect concentration, sleep, or performance. Don’t ignore them.<br><br>

        <strong>👨‍⚕️ Recommended Actions:</strong>
        <ul>
            <li>Consult a counselor or therapist — CBT is especially effective for moderate anxiety.</li>
            <li>Use structured self-help books like “The Anxiety and Phobia Workbook.”</li>
        </ul>

        <strong>🧠 Brain Support:</strong>
        <ul>
            <li>Eat magnesium-rich foods (e.g., spinach, almonds) — helps calm the nervous system.</li>
            <li>Drink plenty of water — dehydration can worsen anxiety symptoms.</li>
        </ul>

        <strong>📌 Habits to Strengthen:</strong>
        <ul>
            <li>Establish wind-down rituals before bed (e.g., warm tea, soft lighting).</li>
            <li>Limit news and doomscrolling — curate your media intake mindfully.</li>
            <li>Keep a “worry journal” — write anxious thoughts and leave them there.</li>
        </ul>
    </div>`;
            } else {
                // Severe Anxiety
                advice = `<div class="p-3 rounded" style="background-color: #FFE4E1; color: #721c24;">
        <h6><i class="fas fa-exclamation-circle"></i> 🔴 Severe Anxiety (Score: ${score})</h6>
        <strong>🚨 Critical Concern:</strong> Your symptoms are significantly affecting your life. Immediate action is essential.<br><br>

        <strong>🆘 Priority Steps:</strong>
        <ul>
            <li>Seek professional mental health support immediately — therapy and/or medication may be needed.</li>
            <li>Build a strong support circle of friends or family members who check in with you daily.</li>
        </ul>

        <strong>⚙️ Daily Stabilization Tools:</strong>
        <ul>
            <li>Create a predictable daily structure — avoid unstructured, chaotic days.</li>
            <li>Use audio guides for progressive muscle relaxation or body scans.</li>
            <li>Practice saying "no" — reduce external stressors wherever possible.</li>
        </ul>

        <strong>📌 Recovery & Hope:</strong>
        <ul>
            <li>Keep a victory log — write down one thing you managed each day, no matter how small.</li>
            <li>Join peer-led support groups — being heard by others with anxiety helps healing.</li>
            <li>You’re not alone. Anxiety is highly treatable. Reach out — help is available.</li>
        </ul>
    </div>`;
            }

            return advice;
        }

    </script>
    <div id="printContainer" style="display: none;"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</body>

</html>