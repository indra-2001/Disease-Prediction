<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TDEE Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            background-image: url('../static/images/TDEE_bg3.webp');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
        }

        .tdee-container {
            max-width: 500px;
            width: 100%;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            border: 5px solid #2196f3;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2196f3;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #2196f3;
            color: white;
            margin-top: 15px;
            cursor: pointer;
        }

        #result {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }

        .modal-content {
            border: 6px solid #1fe0b0;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="tdee-container">
        <h2><i class="fas fa-fire"></i><strong> TDEE Calculator</strong></h2>

        <label for="gender">Gender:</label>
<select id="gender" required>
  <option value="" disabled selected>Select</option>  
  <option value="male">Male</option>
  <option value="female">Female</option>
</select>

<label for="age">Age (years):</label>
<input
  type="number"
  id="age"
  min="10"
  max="120"
  placeholder="Enter age (10‚Äì120)"
  required
/>

<label for="height">Height (cm):</label>
<input
  type="number"
  id="height"
  min="90"
  max="250"
  placeholder="Enter height (90‚Äì250 cm)"
  required
/>

<label for="weight">Weight (kg):</label>
<input
  type="number"
  id="weight"
  min="30"
  max="250"
  step="0.1"
  placeholder="Enter weight (30‚Äì250 kg)"
  required
/>

<label for="activity">Activity Level:</label>
<select id="activity" required>
  <option value="" disabled selected>Select</option>  
  <option value="1.2">Sedentary (little or no exercise)</option>
  <option value="1.375">Lightly active (light exercise/sports 1‚Äì3 days/week)</option>
  <option value="1.55">Moderately active (moderate exercise/sports 3‚Äì5 days/week)</option>
  <option value="1.725">Very active (hard exercise/sports 6‚Äì7 days/week)</option>
  <option value="1.9">Extra active (very intense exercise or physical job)</option>
</select>

        <button onclick="calculateTDEE()" class="Calculate TDEE"><i
                class="fas fa-calculator me-2"></i>Calculate TDEE</button>
                <br><br>
        <a href="/dashboard" class="btn btn-secondary w-100"><i class="fas fa-arrow-left me-2"></i>Back</a>
        <div id="result"></div>
        <button type="button" id="adviceBtn" onclick="showAdvice()" class="btn btn-success mt-3" data-bs-toggle="modal"
            data-bs-target="#staticBackdrop" style="display: none;">
            <i class="fas fa-notes-medical me-2"></i>Get Advices
        </button>
    </div>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="adviceContent"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="downloadAdvicePDF()"><i
                            class="fas fa-download me-2"></i>Download report and advises</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        async function calculateTDEE() {
      const gender = document.getElementById("gender").value;
  const age = parseInt(document.getElementById("age").value);
  const height = parseFloat(document.getElementById("height").value);
  const weight = parseFloat(document.getElementById("weight").value);
  const activity = parseFloat(document.getElementById("activity").value);

  if (!age || !height || !weight) {
    alert("Please enter all required fields.");
    return;
  }

  const bmr = (gender === "male")
    ? 10 * weight + 6.25 * height - 5 * age + 5
    : 10 * weight + 6.25 * height - 5 * age - 161;

  const tdee = bmr * activity;

  document.getElementById("result").innerHTML =
    `Your TDEE is <span style="color:#d32f2f;">${tdee.toFixed(2)}</span> calories/day.`;

  // Show advice button
  document.getElementById("adviceBtn").style.display = "inline-block";

  // Prepare modal content
  document.getElementById("staticBackdropLabel").innerText = "TDEE-Based Advice";
  document.getElementById("adviceContent").innerHTML = getTdeeAdvice(tdee);

    }


        function displayResult(tdee) {
            document.getElementById("result").innerHTML = `Your TDEE is <span style="color:#d32f2f;">${tdee.toFixed(2)}</span> calories/day.`;
            document.getElementById("adviceBtn").style.display = "block"; // Show advice button after result
}
        

        function buildPdfContent(tdee, adviceHtml) {
            const container = document.createElement("div");

    const heading = document.createElement("h1");
    heading.innerText = `Your TDEE: ${tdee.toFixed(2)} calories/day`;
    heading.style.textAlign = "center";
    heading.style.color = "#007bff";
    heading.style.borderBottom = "5px solid #2196f3";
    heading.style.marginBottom = "30px";

    const adviceDiv = document.createElement("div");
    adviceDiv.innerHTML = adviceHtml;
    adviceDiv.style.fontSize = "16px";
    adviceDiv.style.lineHeight = "1.7";
    adviceDiv.style.fontFamily = "Arial, sans-serif";

    container.appendChild(heading);
    container.appendChild(adviceDiv);
    return container;
        }

        async function generatePdfBlob(content) {
            const opt = {
                margin: 0.5,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            return await html2pdf().set(opt).from(content).output('blob');
        }

        async function saveReport(height, weight, tdee, pdfBlob) {
            const formData = new FormData();
            formData.append("height", height);
            formData.append("weight", weight);
            formData.append("category", "TDEE");
            formData.append("result_value", tdee.toFixed(2));
            formData.append("pdf", pdfBlob, "tdee_report.pdf");

       
                fetch("/save_health_result", {
                method: "POST",
                body: formData
            })
            .then(response => {
                if (response.ok) {
                alert("‚úÖ TDEE data and report saved to database.");
                } else {
                alert("‚ùå Failed to save data.");
                }
            })
            .catch(err => {
                console.error("Error:", err);
                alert("‚ùå Error sending data to server.");
            });
            }

        function downloadAdvicePDF() {
            const title = document.getElementById("staticBackdropLabel").innerText;
            const body = document.getElementById("adviceContent").innerHTML;

            const container = document.createElement("div");
            container.innerHTML = `
                <h2 style="color: #2196f3; border-bottom: 2px solid #2196f3;">${title}</h2>
                <div style="font-family: Arial; font-size: 20px;">${body}</div>
            `;

            html2pdf().from(container).set({
                margin: 10,
                filename: 'TDEE_Report_and_Advice.pdf',
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).save();
        }

        function getTdeeAdvice(tdee) {
            if (tdee < 1600)
        return `<strong>üîµ Very Low Daily Energy Needs</strong><br>
üë§ <strong>Profile:</strong> Often corresponds to a sedentary lifestyle with minimal physical activity, such as in older adults or those with limited mobility.<br><br>
<strong>üçΩÔ∏è Nutrition Focus:</strong><ul>
    <li>Opt for nutrient-dense, lower-calorie foods (vegetables, lean protein).</li>
    <li>Control portions to avoid weight gain due to low caloric burn.</li>
    <li>Avoid sugary snacks and calorie-dense beverages.</li>
</ul>
<strong>üèÉ Activity Tips:</strong><ul>
    <li>Begin with gentle movement like daily walks or stretching.</li>
    <li>Gradually incorporate light bodyweight exercises.</li>
</ul>
<strong>üßò Lifestyle Advice:</strong><ul>
    <li>Stay active with daily chores and light mobility routines.</li>
    <li>Ensure adequate hydration and regular sleep for overall wellness.</li>
</ul>`;

    else if (tdee < 2000)
        return `<strong>üü¢ Low to Moderate Energy Needs</strong><br>
üë§ <strong>Profile:</strong> Common for those with light activity levels or desk jobs.<br><br>
<strong>üçΩÔ∏è Nutrition Focus:</strong><ul>
    <li>Eat balanced meals with plenty of vegetables and whole grains.</li>
    <li>Include a mix of lean protein and healthy fats to stay full longer.</li>
    <li>Snack on fruit, nuts, or yogurt instead of processed foods.</li>
</ul>
<strong>üèÉ Activity Tips:</strong><ul>
    <li>Add moderate exercises like brisk walking or cycling (3‚Äì4 times/week).</li>
    <li>Consider short home workouts during breaks to increase activity.</li>
</ul>
<strong>üßò Lifestyle Advice:</strong><ul>
    <li>Break long periods of sitting with stretches or short walks.</li>
    <li>Practice mindfulness or light yoga to reduce stress.</li>
</ul>`;

    else if (tdee < 2400)
        return `<strong>üü° Average Daily Energy Needs</strong><br>
üë§ <strong>Profile:</strong> Reflects a moderately active lifestyle with occasional workouts or daily movement.<br><br>
<strong>üçΩÔ∏è Nutrition Focus:</strong><ul>
    <li>Follow a macro-balanced diet: carbs, protein, fats.</li>
    <li>Support energy levels with complex carbs like oats, quinoa, brown rice.</li>
    <li>Stay hydrated and limit refined sugar.</li>
</ul>
<strong>üèãÔ∏è Fitness Tips:</strong><ul>
    <li>Combine strength training with cardio for optimal results.</li>
    <li>Schedule active weekends ‚Äî hiking, sports, dance, etc.</li>
</ul>
<strong>üßò Wellness Practices:</strong><ul>
    <li>Prioritize 7‚Äì9 hours of quality sleep.</li>
    <li>Use breathing exercises or journaling to manage daily stress.</li>
</ul>`;

    else if (tdee < 2800)
        return `<strong>üü† High Energy Needs</strong><br>
üë§ <strong>Profile:</strong> Typically applies to people with regular exercise routines or physically demanding jobs.<br><br>
<strong>üçΩÔ∏è Nutrition Focus:</strong><ul>
    <li>Ensure sufficient calories from clean sources: grains, protein, healthy fats.</li>
    <li>Don‚Äôt skip meals ‚Äî spread intake across 4‚Äì6 meals/snacks per day.</li>
    <li>Refuel post-workout with protein-carb combos (e.g., smoothie, wrap).</li>
</ul>
<strong>üèãÔ∏è Training Tips:</strong><ul>
    <li>Mix cardio, strength, and flexibility training each week.</li>
    <li>Use progressive overload to improve fitness over time.</li>
</ul>
<strong>üí§ Recovery:</strong><ul>
    <li>Include active recovery days (walks, gentle yoga).</li>
    <li>Track sleep, hydration, and energy to avoid overtraining.</li>
</ul>`;

    else
        return `<strong>üî¥ Very High Energy Needs</strong><br>
üë§ <strong>Profile:</strong> Common for athletes, fitness enthusiasts, or highly active individuals.<br><br>
<strong>üçΩÔ∏è Nutrition Focus:</strong><ul>
    <li>Increase meal frequency and calorie density ‚Äî aim for 5‚Äì6 meals/day.</li>
    <li>Prioritize high-quality proteins and carbs around workouts.</li>
    <li>Use smoothies, nut butters, avocados, and oats to hit calorie targets.</li>
</ul>
<strong>üèãÔ∏è Training Tips:</strong><ul>
    <li>Stick to a periodized workout plan tailored to performance goals.</li>
    <li>Rotate routines to avoid plateauing and injury.</li>
</ul>
<strong>üß† Mental & Physical Recovery:</strong><ul>
    <li>Take deload weeks and monitor signs of fatigue or burnout.</li>
    <li>Include massage, cold showers, or sauna for recovery.</li>
</ul>
<strong>üí° Pro Tips:</strong><ul>
    <li>Track macros and energy output if training competitively.</li>
    <li>Work with a coach or dietitian for personalized optimization.</li>
</ul>`;
}
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
