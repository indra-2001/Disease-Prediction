<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parkinson's Disease Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        body {
            background: linear-gradient(135deg, #e0f2f7, #f0f4c3);
            font-family: 'Segoe UI', sans-serif;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            padding: 40px 30px;
            max-width: 1000px;
            margin-top: 50px;
        }

        h2 {
            font-weight: bold;
            color: #0277bd;
            margin-bottom: 30px;
        }

        .form-label {
            font-weight: 500;
            color: #333;
        }

        .form-control,
        .form-select {
            border-radius: 8px;
        }

        .btn-custom {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #01579b;
        }

        .btn-secondary:hover {
            background-color: #6c757d;
        }

        .result-table {
            margin-top: 30px;
            display: none;
        }

        .table th {
            background-color: #0277bd;
            color: white;
        }

        .form-icon {
            margin-right: 8px;
            color: #0277bd;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="text-center"><i class="fas fa-brain me-2"></i>Parkinson Disease Prediction</h2>
        <form id="parkinsonForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">MDVP:Fo(Hz)[Avg freq]</label>
                        <input type="number" step="any" class="form-control" name="MDVP:Fo(Hz)" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">MDVP:Fhi(Hz)[Max freq]</label>
                        <input type="number" step="any" class="form-control" name="MDVP:Fhi(Hz)" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">MDVP:Flo(Hz)[Min freq]</label>
                        <input type="number" step="any" class="form-control" name="MDVP:Flo(Hz)" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">MDVP:PPQ[Pitch Jitter]</label>
                        <input type="number" step="any" class="form-control" name="MDVP:PPQ" required />
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">MDVP:APQ[Amp Jitter]</label>
                        <input type="number" step="any" class="form-control" name="MDVP:APQ" required />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Shimmer:APQ5</label>
                      <input type="number" step="any" class="form-control" name="Shimmer:APQ5" required />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Shimmer:APQ3</label>
                      <input type="number" step="any" class="form-control" name="Shimmer:APQ3" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">MDVP:Shimmer(dB)</label>
                      <input type="number" step="any" class="form-control" name="MDVP:Shimmer(dB)" />
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-custom"><i class="fas fa-microscope me-2"></i>Predict</button>
            <a href="/dashboard" class="btn btn-secondary btn-custom mt-3"><i class="fas fa-arrow-left me-2"></i>Back</a>
        </form>

        <div class="result-table">
            <h4 class="text-center mt-4">Prediction Result</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="resultBody"></tbody>
            </table>
            <button id="downloadPdf" class="btn btn-success btn-custom mt-2"><i class="fas fa-download me-2"></i>Download Report</button>
            <br>
            <div class="d-flex justify-content-center">
                <button type="button" id="adviceBtn" class="btn btn-success mt-3" data-bs-toggle="modal"
                    data-bs-target="#staticBackdrop" style="display: inline-block;">
                    <i class="fas fa-notes-medical me-2"></i>See Advices
                </button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="adviceContent">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        //For report PDF generation
        document.getElementById("downloadPdf").addEventListener("click", function () {
            if (!globalFormData) {
                alert("Please submit the form first to generate prediction.");
                return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(18);
            doc.text("Parkinson Disease Prediction Report", 14, 22);

            // User Input Data
            doc.setFontSize(12);
            doc.text("User Input Data:", 14, 32);

            const inputData = [];
            document.querySelectorAll("#resultBody tr").forEach(row => {
                const cols = row.querySelectorAll("td");
                inputData.push([cols[0].innerText, cols[1].innerText]);
            });

            doc.autoTable({
                startY: 36,
                head: [['Parameter', 'Value']],
                body: inputData,
                theme: 'grid',
                styles: { fontSize: 9 }
            });

            // Gather form data for sending again
            fetch("/parkinson", {
                method: "POST",
                body: new URLSearchParams(globalFormData)
            })
                .then(response => response.json())
                .then(data => {
                    // Add advice based on prediction
                    let y = doc.lastAutoTable.finalY + 15;
                    doc.setFontSize(16);
                    doc.setFont("helvetica", "bold");
                    doc.text("Trusted Advices:", 14, y);
                    y += 8;
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "normal");

                    if (parseInt(data.result) === 1) {
                        const adviceText = `The prediction suggests the presence of indicators associated with Parkinson's Disease. It is crucial to consult with a neurologist for a comprehensive evaluation and diagnosis. They may recommend further tests and discuss potential management strategies. Maintaining a healthy lifestyle, including regular exercise and a balanced diet, can also be beneficial. Support groups and resources are available to help individuals and their families cope with Parkinson's Disease.`;
                        const wrappedAdvice = doc.splitTextToSize(adviceText, 180);
                        doc.text(wrappedAdvice, 14, y);
                    } else {
                        const adviceText = `The prediction does not indicate the presence of typical indicators associated with Parkinson's Disease based on the provided data. However, if you have any concerns or experience any new symptoms, it is always recommended to consult with a healthcare professional for a thorough evaluation. Maintaining a healthy lifestyle is important for overall well-being.`;
                        const wrappedAdvice = doc.splitTextToSize(adviceText, 180);
                        doc.text(wrappedAdvice, 14, y);
                    }

                    // Save the PDF after advice is added
                    doc.save("Parkinson_Disease_Prediction_Report.pdf");
                });
        });

        // Displaying result table
        let globalFormData = null;

        document.getElementById("parkinsonForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            globalFormData = formData;
            fetch("/parkinson", {
                method: "POST",
                body: new URLSearchParams(formData)
            })
                .then(response => response.json())
                .then(data => {
                    const resultTable = document.querySelector(".result-table");
                    const resultBody = document.getElementById("resultBody");
                    resultBody.innerHTML = "";
                    for (let [key, value] of formData.entries()) {
                        const element = document.querySelector(`[name="${key}"]`);
                        let displayValue = value;

                        if (element && element.tagName === "SELECT") {
                            displayValue = element.options[element.selectedIndex].text;
                        }

                        resultBody.innerHTML += `<tr><td>${key}</td><td>${displayValue}</td></tr>`;
                    }
                    resultBody.innerHTML += `<tr><td><strong>Prediction</strong></td><td><strong>${data.prediction}</strong></td></tr>`;
                    resultTable.style.display = "block";

                    if (parseInt(data.result) === 1) {
                        document.getElementById("staticBackdropLabel").innerHTML = `<strong style="font-size: 1.3rem;">ðŸ”´ Signs of Parkinson's Disease Detected</strong>`;
                        document.getElementById("adviceContent").innerHTML = `The prediction suggests the presence of indicators associated with Parkinson's Disease. It is crucial to consult with a neurologist for a comprehensive evaluation and diagnosis. They may recommend further tests and discuss potential management strategies. Maintaining a healthy lifestyle, including regular exercise and a balanced diet, can also be beneficial. Support groups and resources are available to help individuals and their families cope with Parkinson's Disease.`;
                    } else {
                        document.getElementById("staticBackdropLabel").innerHTML = `<strong style="font-size: 1.3rem;">ðŸŸ¢ No Strong Signs of Parkinson's Disease Detected</strong>`;
                        document.getElementById("adviceContent").innerHTML = `The prediction does not indicate the presence of typical indicators associated with Parkinson's Disease based on the provided data. However, if you have any concerns or experience any new symptoms, it is always recommended to consult with a healthcare professional for a thorough evaluation. Maintaining a healthy lifestyle is important for overall well-being.`;
                    }
                });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>