<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PSS-10 Stress Screening</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        body {
            background: linear-gradient(to right, #e3f2fd, #ffffff);
            font-family: 'Segoe UI', sans-serif;

            margin: 0;
            padding: 0;
            background-image: url('../static/images/stress_sc_background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;

            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            margin-top: 60px;
            max-width: 900px;
        }

        .card {
            border-radius: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border:  6px solid #6cfafa;
            background-color: #e9f8f4;
            padding: 2rem;
        }

        h2 {
            font-weight: bold;
            color: #0d6efd;
        }

        label.form-label {
            font-weight: 500;
        }

        .btn-primary {
            background-color: #0d6efd;
            border: none;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background-color: #0b5ed7;
        }

        .btn-secondary {
            background-color: #6c757d;
            border: none;
            transition: 0.3s;
        }

        .btn-secondary:hover {
            background-color: #5c636a;
        }

        .form-select {
            border-radius: 0.5rem;
        }

        .result {
            background: #e6ffed;
            border-left: 6px solid #28a745;
            padding: 18px;
            margin-top: 25px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 1rem;
            color: #155724;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .btn i {
            margin-right: 8px;
        }

        .modal-content {
            border: 6px solid #dbfd18;
            border-radius: 10px;
        }

        /* @media (max-width: 768px) {
            .card {
                padding: 1.5rem;
            }
        } */
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <h2 class="mb-4 text-center"><i class="fas fa-brain me-2"></i>Stress Screening</h2>
            <form id="pss-10Form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="q1" class="form-label">1. In the last month, how often have you been upset because something that happened unexpectedly?</label>
                            <select id="q1" name="q1" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q2" class="form-label">2. In the last month, how often have you felt that you were unable to control the important things in your life?</label>
                            <select id="q2" name="q2" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q3" class="form-label">3. In the last month, how often have you felt nervous and 'stressed'?</label>
                            <select id="q3" name="q3" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q4" class="form-label">4. In the last month, how often have you felt 
                                <br>confident about your ability to handle your personal problems?</label>
                            <select id="q4" name="q4" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q5" class="form-label">5. In the last month, how often have you felt that things were going your way?</label>
                            <select id="q5" name="q5" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="q6" class="form-label">6. In the last month, how often have you found that you could not cope with all the things that you had to do?</label>
                            <select id="q6" name="q6" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q7" class="form-label">7. In the last month, how often have you been able to control irritations in your life?</label>
                            <select id="q7" name="q7" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q8" class="form-label">8. In the last month, how often have you felt that you were on top of things?</label>
                            <select id="q8" name="q8" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q9" class="form-label">9. In the last month, how often have you been angered because of things that were outside of your control?</label>
                            <select id="q9" name="q9" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="q10" class="form-label">10. In the last month, how often have you felt difficulties were piling up so high that you could not overcome them</label>
                            <select id="q10" name="q10" class="form-select" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Never</option>
                                <option value="1">Almost never</option>
                                <option value="2">Sometimes</option>
                                <option value="3">Fairly often</option>
                                <option value="4">Very often</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-3"><i class="fas fa-check-circle"></i> Submit
                    Screening</button>
                <a href="/dashboard" class="btn btn-secondary w-100 mt-3"><i class="fas fa-arrow-left"></i> Back to
                    Dashboard</a>
            </form>

             <div id="depResult" class="result mt-3" style="display: none;"></div>
            <button type="button" id="adviceBtn" class="btn btn-success mt-3" data-bs-toggle="modal"
                data-bs-target="#staticBackdrop" style="display: none;">
                <i class="fas fa-notes-medical me-2"></i>Get Advices
            </button>
        </div>
    </div>

    <!-- modal start-->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="adviceContent">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="downloadAdvicePDF()"><i
                            class="fas fa-download me-2"></i>Download report and advises</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal End-->

    <script>
        document.getElementById("pss-10Form").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            fetch("/stress_screening", {
                method: "POST",
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    const resultBox = document.getElementById("depResult");
                    resultBox.style.display = "block";
                    if (data.error) {
                        resultBox.innerHTML = "‚ùå Error: " + data.error;
                        resultBox.classList.remove("bg-success");
                        resultBox.classList.add("bg-danger", "text-white");
                    } else {
                        resultBox.classList.remove("bg-danger", "text-white");
                        resultBox.innerText = data.message;
                        document.getElementById("adviceBtn").style.display = "block";

                        document.getElementById("staticBackdropLabel").innerHTML = data.message;
                        document.getElementById("adviceContent").innerHTML = getAdvice(parseInt(data.score));
                    }
                });
        });


        function downloadAdvicePDF() {
            const adviceTitle = document.getElementById("staticBackdropLabel").innerText;
            const adviceBody = document.getElementById("adviceContent").innerHTML;

            const pdfContainer = document.createElement("div");
            pdfContainer.innerHTML = `
            <div style="text-align: center; font-family: 'Segoe UI', sans-serif; margin-bottom: 20px; padding-bottom: 5px;">
                <h1 style="color: #1e88e5; font-size: 31px; margin-bottom: 0;">üìù Your Stress Screening Report</h1>
                <p style="color: #555; font-size: 16px; margin-top: 5px; border-bottom: 2px solid #2196f3;">Based on the PSS-10 Assessment</p>
            </div>
            <div style="color: #2196f3; font-size: 25px;  padding-bottom: 10px;"><strong>${adviceTitle}</strong></div>
            <div style="font-family: Arial, sans-serif; font-size: 20px; padding-top: 10px">${adviceBody}</div>
            `;

            html2pdf()
                .from(pdfContainer)
                .set({
                    margin: 10,
                    filename: 'Stress_Screening_Report.pdf',
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                })
                .save();
        }


        function getAdvice(score) {
            let advice = "";

            if (score <= 13) {
        // Low Stress
        advice = `<div class="p-3 rounded" style="background-color: #E6FFFA; color: #155724;">
        <h6><i class="fas fa-smile-beam"></i> üü¢ Low Stress (Score: ${score})</h6>
        <strong>‚úÖ Interpretation:</strong> You are showing low levels of stress. That‚Äôs a healthy sign!<br><br>

        <strong>üå± Maintain Your Balance:</strong>
        <ul>
            <li>Keep practicing the habits that support your calm ‚Äî regular sleep, balanced meals, and light exercise.</li>
            <li>Engage in hobbies that bring joy and relaxation (music, art, gardening, etc.).</li>
            <li>Continue building strong social connections with friends or family.</li>
        </ul>

        <strong>üìå Preventive Tips:</strong>
        <ul>
            <li>Use brief daily check-ins with yourself to stay self-aware.</li>
            <li>Even during calm periods, keep up a mindfulness or gratitude routine.</li>
        </ul>
    </div>`;
    } else if (score <= 26) {
        // Moderate Stress
        advice = `<div class="p-3 rounded" style="background-color: #FFFACD; color: #856404;">
        <h6><i class="fas fa-meh"></i> üü° Moderate Stress (Score: ${score})</h6>
        <strong>üîç Interpretation:</strong> You may be experiencing moderate stress. It's common but important to manage it before it builds up.<br><br>

        <strong>üßò Stress Management Tips:</strong>
        <ul>
            <li>Practice deep breathing, progressive muscle relaxation, or short meditations daily.</li>
            <li>Take regular breaks from work or screen time ‚Äî try the 20-20-20 rule.</li>
            <li>Limit caffeine and alcohol intake as they can increase anxiety.</li>
            <li>Engage in physical activity like walking, yoga, or stretching.</li>
        </ul>

        <strong>üí¨ Emotional Check-ins:</strong>
        <ul>
            <li>Talk to someone you trust about how you're feeling.</li>
            <li>Journaling can help organize thoughts and reduce mental clutter.</li>
        </ul>

        <strong>üìå Monitor Progress:</strong>
        <ul>
            <li>If stress persists or increases, consider consulting a mental health professional.</li>
        </ul>
    </div>`;
    } else {
        // High Stress
        advice = `<div class="p-3 rounded" style="background-color: #F8D7DA; color: #721c24;">
        <h6><i class="fas fa-exclamation-circle"></i> üî¥ High Stress (Score: ${score})</h6>
        <strong>‚ö†Ô∏è Interpretation:</strong> You are currently experiencing high levels of stress. It's important to address this proactively.<br><br>

        <strong>üÜò Steps to Take:</strong>
        <ul>
            <li>Seek support from a mental health counselor or therapist.</li>
            <li>Structure your day with realistic goals and boundaries.</li>
            <li>Try guided meditations, calming apps, or breathing exercises several times a day.</li>
            <li>Make time for restful sleep and avoid overstimulation before bed.</li>
        </ul>

        <strong>üìå Emergency Tips:</strong>
        <ul>
            <li>Write down what‚Äôs overwhelming you and tackle one issue at a time.</li>
            <li>Don‚Äôt hesitate to lean on trusted friends, family, or support lines.</li>
        </ul>

        <strong>üí° Reminder:</strong>
        <ul>
            <li>Chronic stress can lead to burnout or health issues ‚Äî take action early.</li>
            <li>You deserve support. Help is available, and you are not alone.</li>
        </ul>
    </div>`;
    }


            return advice;
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</body>

</html>